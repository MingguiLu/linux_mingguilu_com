+++
date = "2016-12-15T13:53:45+08:00"
title = "打造Ubuntu桌面"
menu = ""
categories = ["Ubuntu"]
tags = ["Ubuntu16.04","Ubuntu桌面"]
images = []
banner = ""

+++

### 1. 初始配置
#### 1.1 Ubuntu 16.04新特性
* 默认禁用dash在线搜索

* 使用GNOME Software代替Ubuntu软件中心

* 自定义Unity所处位置

* apt命令升级：apt可代替apt-get

* 支持ZFS文件系统

* 软件更新：Linux4.4 LTS、LibreOffice5.1、Python3.5、Docket1.10


#### 1.2 设置root密码

	sudo passwd root

#### 1.3 切换到root用户

	su

或

	sudo -i

#### 1.4 自定义Unity所处位置

	gsettings set com.canonical.Unity.Launcher launcher-position Bottom|Left

#### 1.5 查看Ubuntu版本

	lsb_release -a

#### 1.6 查看内核版本

	uname -a

#### 1.7 查看硬件驱动

	lspci

#### 1.8 打开终端快捷键

	Ctrl+Alt+T

#### 1.9 切换控制台tty1-tt6

	Ctrl+Alt+F1~F6

回到桌面

	Ctrl+Alt+F7

#### 1.10 网络配置

##### 1.10.1 图形化操作

系统设置——>网络——>有线/无线——>选项——>IPv4设置——>自动(DHCP)/手动

![](/images/Ubuntu_1_10_1_01.png)

##### 1.10.2 终端操作

查看网卡配置文件(/etc/network/interfaces)默认配置如下

	$ cat /etc/network/interfaces
	# interfaces(5) file used by ifup(8) and ifdown(8)
	auto lo
	iface lo inet loopback

配置DHCP自动获取，在配置文件末尾添加：

	auto ens33
	iface ens33 inet dhcp

配置静态IP，在配置文件末尾添加：

	auto ens33
	iface ens33 inet static
	address 192.168.1.120
	netmask 255.255.255.0
	gateway 192.168.1.1

配置DNS地址，修改/etc/resolv.conf文件为：

	# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
	#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
	# nameserver 127.0.1.1
	nameserver 192.168.1.1
	nameserver 202.103.24.68

但以上配置只是临时的，在重启系统或者重启网卡之后，就不生效了。要永久有效，需要在/etc/resolvconf/resolv.conf.d/base中添加DNS地址

	$ cat /etc/resolvconf/resolv.conf.d/base
	nameserver 192.168.1.1
	nameserver 202.103.24.68

重启网络

	sudo service networking restart

或

	sudo /etc/init.d/networking restart

或

	sudo systemctl restart networking.service

但见证奇迹的时刻到了!

ifconfig查看网卡信息，ip地址依然是DHCP自动获取的192.168.1.114;

	$ ifconfig
	ens33     Link encap:以太网  硬件地址 00:0c:29:71:70:f0  
			  inet 地址:192.168.1.114  广播:192.168.1.255  掩码:255.255.255.0
			  inet6 地址: fe80::b69c:e0ad:fc8c:5ec3/64 Scope:Link
			  UP BROADCAST RUNNING MULTICAST  MTU:1500  跃点数:1
			  接收数据包:98507 错误:0 丢弃:0 过载:0 帧数:0
			  发送数据包:30429 错误:0 丢弃:0 过载:0 载波:0
			  碰撞:0 发送队列长度:1000
			  接收字节:99756941 (99.7 MB)  发送字节:3526694 (3.5 MB)

ip add查看网卡信息，ens33出现两个IP地址，192.168.1.114是之前DHCP获取的，192.168.1.120是配置的静态IP，而且网络访问正常

	$ ip add
	2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
		link/ether 00:0c:29:71:70:f0 brd ff:ff:ff:ff:ff:ff
		inet 192.168.1.114/24 brd 192.168.1.255 scope global dynamic ens33
		   valid_lft 86379sec preferred_lft 86379sec
		inet 192.168.1.120/24 brd 192.168.1.255 scope global secondary ens33
		   valid_lft forever preferred_lft forever

经过各种尝试，找到解决方法：先停止网络服务，在启用网络服务，虽然与重启网络服务原理一样，不过效果却不一样

	sudo service networking stop
	sudo service networking start

这个方法同样适用于修改静态ip后，重启网络服务新的IP地址不生效的问题

### 2. 常用桌面软件安装

#### 2.1 安装VMware tools (root用户执行)

VMware Workstation ——> 虚拟机 ——> 安装VMware Tools
挂载VMware Tools安装光盘

	su

	mount /dev/sr0 /mnt

把VMware Tools安装文件拷贝至root主目录

	cp /mnt/VMwareTools-10.0.10-4301679.tar.gz .

解压缩VMmareTools安装文件

	tar xvf VMwareTools-10.0.10-4301679.tar.gz

解压完毕后进入vmware-tools-distrib目录

	cd vmware-tools-distrib

运行vmware-install.pl

	./vmware-install.pl

DO you still want to proceed with this legacy installer?[no]

	输入 yes ，回车

接下来一路回车，直至安装完成。重启系统后，即可自适应窗口、拖放文件等

#### 2.2 删除Amazon链接

	sudo apt-get remove unity-webapps-common  

#### 2.3 卸载Libreoffice

	sudo apt-get remove libreoffice-common

#### 2.4 安装 Unity Tweak Tool

	sudo apt-get install unity-tweak-tool

查看unity-tweak-tool安装了哪些文件

	dpkg -L unity-tweak-tool

启动Unity Tweak Tool

	/usr/bin/unity-tweak-tool

#### 2.5 安装[Numix](https://www.numixproject.org/)主题和图标

添加Numix源

    sudo apt-add-repository ppa:numix/ppa
    sudo apt-get update

安装GTK主题

	sudo apt-get install numix-gtk-theme

安装Numix图标

    sudo apt-get install numix-icon-theme-circle

在Unity-tweak-tool中启用Numix daily主题和Numix-circle图标
![](/images/Ubuntu_2_5_01.png)

#### 2.6 安装指示器

大小写指示灯和触摸板开关

    sudo add-apt-repository ppa:tsbarnes/indicator-keylock
    sudo add-apt-repository ppa:atareao/atareao
    sudo apt-get update
    sudo apt-get install indicator-keylock
    sudo apt-get install touchpad-indicator

#### 2.7 安装系统监测工具Syspeek
![](/images/Ubuntu_2_7_01.png)

	sudo add-apt-repository ppa:nilarimogard/webupd8    
	sudo apt-get update    
	sudo apt-get install syspeek

#### 2.8 安装经典菜单插件
![](/images/Ubuntu_2_8_01.png)

	sudo add-apt-repository ppa:diesch/testing  
	sudo apt-get update  
	sudo apt-get install classicmenu-indicator

#### 2.9 安装Google Chrome浏览器

	sudo apt-get install google-chrome-stable

解决软件包依赖关系

	sudo apt-get -f install

#### 2.10 安装Adobe Flash Player
##### 2.10.1 在Firefox中打开 https://get.adobe.com/flashplayer/?loc=cn
已自动识别出：`Linux 64-bit, 简体中文, Firefox`，选择版本为

	.tar.gz 适用于 Linux

立即下载，然后提取flash_player_npapi_linux.x86_64.tar.gz

按照readme.txt方法

	sudo cp libflashplayer.so /usr/lib/firefox-addons/plugins/ -v
	sudo cp -r usr/* /usr

##### 2.10.2 在Chrome中打开 https://get.adobe.com/cn/flashplayer/otherversions/

选择操作系统为：

	Linux(64-bit)

选择版本为

	xxx for Linux 64-bit(.tar.gz)- PPAPI

立即下载，然后提取flash_player_ppapi_linux.x86_64.tar.gz

按照readme.txt方法

	sudo cp ~/下载/flash_player_ppapi_linux.x86_64/* /usr/lib/adobe-flashplugin/ -rvf

如果`/usr/lib/adobe-flashplugin`目录不存在，可以自己创建一个再进行上一步，也起作用

	sudo mkdir /usr/lib/adobe-flashplugin

#### 2.11 配置[老D的Google Hosts](https://laod.cn/hosts/2016-google-hosts.html)
下载老D最新的Google hosts文件，添加以下部分到 `/etc/hosts`

	# Modified hosts start

	......

	# Modified hosts end

以root用户编辑 `/etc/hosts`

	sudo gedit /etc/hosts

重启网络使hosts本地解析生效

	sudo systemctl restart NetworkManager

#### 2.12 添加Ubuntu Kylin的apt源,方便安装常用的桌面软件

	sudo vim /etc/apt/sources.list.d/ubuntukylin.list

	deb http://archive.ubuntukylin.com:10006/ubuntukylin trusty main

	sudo apt-get update

#### 2.13 安装搜狗输入法

	sudo apt-get install sogoupinyin

#### 2.14 安装[网易云音乐](http://music.163.com/)

	sudo apt-get install netease-cloud-music

或者，下载 [ubuntu16.04 (64位) 版本的云音乐](http://music.163.com/#/download)并安装

	sudo dpkg -i netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb

解决软件包依赖关系

	sudo　apt-get -f install

#### 2.15 安装[有道词典](http://cidian.youdao.com/index-linux.html)
![](/images/Ubuntu_2_15_01.png)

参考：[Ubuntu 16.04安装有道词典](http://www.linuxdiyf.com/linux/20622.html)

下载Ubuntu 64位的deb包：[youdao-dict_1.1.0-0-ubuntu_amd64.deb](http://cidian.youdao.com/index-linux.html)

创建youdao-dict目录，把该deb包解压到youdao-dict目录：

	sudo dpkg -X youdao-dict_1.1.0-0-ubuntu_amd64.deb  youdao-dict

解压deb包中的control信息（包的依赖就写在这个文件里面）：

	sudo dpkg -e youdao-dict_1.1.0-0-ubuntu_amd64.deb youdao-dict/DEBIAN

编辑control文件，删除Depends行尾的gstreamer0.10-plugins-ugly。

	sudo gedit youdao-dict/DEBIAN/control

重新打包：

	sudo dpkg-deb -b youdao-dict youdaobuild.deb

安装重新打包的安装包

	sudo dpkg -i youdaobuild.deb

安装完毕即可使用，屏幕取词和滑词翻译均能正常使用，喜大普奔！当切换到其他窗口有道词典会自动最小化到右上角任务栏

使用apt-get和dpkg安装deb包测试多次都安装失败，原因正是因为:

	未安装软件包 gstreamer0.10-plugins-ugly

#### 2.16 安装[WPS Office](http://community.wps.cn/download/)

下载 wps-office_10.1.0.5672~a21_amd64.deb 并安装

	sudo dpkg -i wps-office_10.1.0.5672~a21_amd64.deb

打开wps会提示缺失symbol、wingdings、wingdings 2、wingdings 3、webding、mtextra 6个字体，在Windows上C:\Windows\Fonts搜索拷贝这6个字体到Ubuntu的usr/share/fonts/下即可。

百度云分享链接: http://pan.baidu.com/s/1pL6ONHL 密码: 2stm

#### 2.17 安装Shadowsocks

	sudo add-apt-repository ppa:hzwhuang/ss-qt5
  	sudo apt-get update
	sudo apt-get install shadowsocks-qt5

#### 2.18 安装Irssi

	sudo apt-get install screen
	sudo apt-get install irssi

#### 2.19 安装迅雷的替代者Xware-desktop

![](/images/Ubuntu_2_19_01.png)

在百度网盘中下载最新的Xware-desktop：http://pan.baidu.com/s/1qWHMlK4

	sudo chmod +x xware-desktop_0.11.20140723_amd64.deb
	sudo dpkg -i xware-desktop_0.11.20140723_amd64.deb
	sudo apt-get install -f

#### 2.20 安装[Vivaldi浏览器](https://vivaldi.com)

![](/images/Ubuntu_2_20_01.png)

下载[Vivaldi的deb安装包](https://vivaldi.com/download/)

	sudo dpkg -i vivaldi-stable_1.6.689.46-1_amd64.deb

#### 2.21 自定义截图快捷键
系统设置——>键盘——>快捷键——>截图

![](/images/Ubuntu_2_21_01.png)

#### 2.22 安装[Teamviewer](https://www.teamviewer.com/zhcn/)

![](/images/Ubuntu_2_22_01.png)

下载Ubuntu版[Teamviewer_12.0.71510_i386.deb](https://www.teamviewer.com/zhcn/download/linux/),注意必须下载32位的版本

为64位Ubuntu16.04添加32位架构支持

	sudo dpkg --add-architecture i386

安装Teamviewer的依赖包

	sudo apt-get update

	sudo apt-get install libdbus-1-3:i386 libasound2:i386 libexpat1:i386 libfontconfig1:i386 libfreetype6:i386 libjpeg62:i386 libpng12-0:i386 libsm6:i386 libxdamage1:i386 libxext6:i386 libxfixes3:i386 libxinerama1:i386 libxrandr2:i386 libxrender1:i386 libxtst6:i386 zlib1g:i386 libc6:i386

安装Teamviewer12

	sudo dpkg -i teamviewer_12.0.71510_i386.deb 

### 3. 常用工具软件安装
#### 3.1 安装Albert

![](/images/Ubuntu_3_1_01.gif)

安装方法参考[Albert WIki](https://github.com/ManuelSchneid3r/albert/wiki)的《How to install albert》

	sudo add-apt-repository ppa:nilarimogard/webupd8
	sudo apt-get update
	sudo apt-get install albert

#### 3.2  安装Vim

	sudo apt-get install vim

#### 3.3 安装Filezilla

	sudo apt-get install filezilla

#### 3.4 安装[Git](https://git-scm.com/)

	sudo apt-get install git

#### 3.5 安装[Sublime Text 3](www.sublimetext.com/)

	sudo add-apt-repository ppa:webupd8team/sublime-text-3    
	sudo apt-get update    
	sudo apt-get install sublime-text

如果修改`Preferences.sublime-settings - User`后提示没有权限保存

	 sudo chmode o+rwx ~/.config/sublime-text-3/ -R

关于Sublime Text 3在Ubuntu下无法输入中文的问题，尝试了网上很多方法都没有解决

#### 3.6 安装[Notepadqq](http://notepadqq.altervista.org/wp/download/)
Notepadqq功能近似于Windows下的Notepad++

	sudo add-apt-repository ppa:notepadqq-team/notepadqq
	sudo apt-get update
	sudo apt-get install notepadqq

#### 3.7 安装[Atom](https://atom.io/)
安装过程因为下载速度奇慢，建议单独开一个Terminal,耐心等待

	sudo add-apt-repository ppa:webupd8team/atom
	sudo apt-get update
	sudo apt-get install atom

#### 3.8 安装Hugo(由Go语言实现的静态网站生成器)

	sudo apt-get install hugo

#### 3.9 安装[VMware Workstation](https://my.vmware.com/cn/web/vmware/login)
下载[VMware Workstation Pro for Linux](https://my.vmware.com/cn/group/vmware/details?downloadGroup=WKST-1252-LX&productId=524&rPId=13365)
安装方法参考官方文档：http://pubs.vmware.com/workstation-12/index.jsp#com.vmware.ws.using.doc/GUID-1F5B1F14-A586-4A56-83FA-2E7D8333D5CA.html

	su root
	sh VMware-Workstation-Full-12.5.2-4638234.x86_64.bundle

稍等弹出图形化的安装界面，与windows上安装相似，一路下一步至安装完毕。

#### 3.10　安装[Visual Studio Code](https://code.visualstudio.com/)

![](/images/Ubuntu_3_10_01.png)

下载Ubuntu版的.deb包 ：[code_1.10.1-1488415350_amd64.deb](https://code.visualstudio.com/docs/?dv=linux64_deb)

安装.deb包

	sudo dpkg -i code_1.10.1-1488415350_amd64.deb

### 4. 使用Samba与Windows共享文件

#### 4.1 搭建Samba服务

安装samba和smbclient

	sudo apt-get install samba smbclient

创建共享目录

	sudo mkdir -p /home/share
	sudo chmod -R 777 /home/share

添加samba用户

	sudo useradd -s /sbin/nologin share
	#创建一个samba用户，不能用于登录系统

设置用户密码

	sudo smbpasswd -a share

配置smb配置文件

	sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak
	sudo vim /etc/samba/smb.conf

	[share]
		comment = Shared Folder require password
		path = /home/share
		browseable = yes
		guest ok = yes
		writable = yes
		valid users = share
		create mask = 0777
		directory mask = 0777
		available = yes


	#常用选项
	#[shared_name]							 # 共享名称
	#    comment =                           # 共享描述
	#    path =                              # 文件系统路径
	#    browseable = {yes|no}               # 是否可以被查看到
	#    public = {yes|no}                   # 是否可被所有人读
	#    guest ok = {yes|no}                 # 与 public 相同
	#    read only = yes                     # 是否只读
	#    writeable = yes                     # 是否可写
	#    write list = user1, user2           # 可写用户列表
	#                @group, +group          # 可写组列表
	#    valid users =                       # 白名单
	#    invalid users =                     # 黑名单
	#	 create mask = 	                     # 默认创建文件的权限
	# 	 directory mask =                    # 默认创建目录的权限
	#    available = {yes|no}				 # 是否启用该目录共享

重启samba服务

	sudo service smbd restart

或

	sudo /etc/init.d/smbd restart

或

	sudo systemctl restart smbd.service

查看samba服务的状态

	sudo smbstatus

#### 4.2 在Windows上访问Ubuntu的共享目录

Windows上使用FQDN路径访问，在开始或者资源管理器地址栏输入：

	\\192.168.1.114

![](/images/Ubuntu_4_2_01.png)

Windwos上断开与samba共享目录的链接

	net use \\192.168.1.114\share /del /y

或

	net use * /del /y
	#注意*代表断开所有的共享链接，如果有多个共享链接时，应避免使用*

![](/images/Ubuntu_4_2_02.png)

Windows上映射samba共享目录为网络映射驱动器

![](/images/Ubuntu_4_2_03.png)

#### 4.3 在Ubuntu上访问Windows共享目录

在Ubuntu文件管理器上，点击“连接到服务器”，输入: smb://192.168.1.110 ，点击“连接”

![](/images/Ubuntu_4_2_04.png)

在Ubuntu上使用mount挂载Windows共享目录

	sudo mount -t cifs -o username=awesomeit //192.168.1.110/d /mnt/share/
	#回车之后输入Windows用户“awesomeit”的密码，把Windows上的共享目录”d“挂载到ubuntu的“/mnt/share”（需先创建好）下

	#使用mount挂载windows共享目录一定要先安装cifs-utils,否则挂载时会有如下报错：
	mount: //192.168.1.110/d is write-protected, mounting read-only
	mount: cannot mount //192.168.1.110/d read-only

安装cifs-utils

	sudo apt-get install cifs-utils

查看已挂载的共享目录

	sudo mount | tail -1
	//192.168.1.110/d on /mnt/share type cifs (rw,relatime,vers=1.0,cache=strict,username=awesomeit,domain=DESKTOP-L440,uid=0,noforceuid,gid=0,noforcegid,addr=192.168.1.110,file_mode=0755,dir_mode=0755,nounix,serverino,mapposix,rsize=61440,wsize=65536,actimeo=1)

在Ubuntu上使用umount卸载Windows共享目录的挂载点

	sudo umount /mnt/share

	#卸载挂载点时，必须先离开挂载点目录，否则会报错：
	umount: /mnt/share: target is busy
			(In some cases useful info about processes that
			 use the device is found by lsof(8) or fuser(1).)

### 5. 使用ssh远程登录Ubuntu

Ubuntu16.04默认安装了“openssh-client”，但未安装“openssh-server”，在远程ssh时会提示：

	$ ssh awesomeit@192.168.1.114
	ssh: connect to host 192.168.1.114 port 22: Connection refused

安装openssh-server

	sudo apt-get install openssh-server

安装完成即可使用ssh远程登录

	$ ssh awesomeit@192.168.1.114
	The authenticity of host '192.168.1.114 (192.168.1.114)' can't be established.
	ECDSA key fingerprint is SHA256:bNfIXbmCCh1qzw9d5VkOWecltbZV1OaKizH8pLuMigo.
	Are you sure you want to continue connecting (yes/no)? yes
	Warning: Permanently added '192.168.1.114' (ECDSA) to the list of known hosts.
	awesomeit@192.168.1.114's password:
	Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-57-generic x86_64)

	 * Documentation:  https://help.ubuntu.com
	 * Management:     https://landscape.canonical.com
	 * Support:        https://ubuntu.com/advantage

	1 个可升级软件包。
	0 个安全更新。

	Last login: Thu Jan  5 22:28:15 2017 from 192.168.1.107
	awesomeit@awesomeit-virtual-machine:~$
	awesomeit@awesomeit-virtual-machine:~$

但是默认不允许root用户远程ssh登录

	$ ssh root@192.168.1.114
	root@192.168.1.114's password:
	Permission denied, please try again.
	root@192.168.1.114's password:
	Permission denied, please try again.

如要开启root用户ssh远程登录（不建议这样做），需修改配置文件"/etc/ssh/sshd_config"

	sudo vim /etc/ssh/sshd_config

注释掉“PermitRootLogin prohibit-password”，添加“PermitRootLogin yes”

	#PermitRootLogin prohibit-password
	PermitRootLogin yes

重启ssh服务

	sudo service ssh restart

再测试即可使用root用户ssh远程登录

	sudo service ssh restart

	$ ssh root@192.168.1.114
	root@192.168.1.114's password:
	Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-57-generic x86_64)

	 * Documentation:  https://help.ubuntu.com
	 * Management:     https://landscape.canonical.com
	 * Support:        https://ubuntu.com/advantage

	1 个可升级软件包。
	0 个安全更新。

	Last login: Thu Jan  5 22:38:09 2017 from 192.168.1.107
	root@awesomeit-virtual-machine:~#
